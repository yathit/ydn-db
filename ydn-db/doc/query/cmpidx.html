
<!DOCTYPE html>
<html lang="en" class="no-js no-touch">
  <head>

    <link type="text/css" rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro">
    
<meta charset="utf-8" />


<title>
  
    Compound index
  
</title>





<meta name="author" content="https://plus.google.com/+KyawTun-Yathit/posts" />



<meta name="description" content="NoSQL query" />


<link rel="icon" href="/favicon.ico" />

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta id="viewport" name="viewport" content="width=device-width, initial-scale=1" />

<meta name="twitter:card" content="summary">
<meta property="twitter:account_id" content="@yathit" />
<meta property="twitter:site" content="@yathit" />
<meta property="twitter:description" content="NoSQL query" />
<meta property="twitter:creator" content="@yathit" />
<meta property="twitter:image:src" content="/ydn-db/imgs/logo.png" />


<link rel="author" href="https://plus.google.com/+KyawTun-Yathit/posts">
<link rel="publisher" href="https://plus.google.com/+KyawTun-Yathit">

<meta itemprop="name" content="
  
    Compound index
  
">
<link itemprop="image" href="/imgs/logo.png">
<meta itemprop="description" content="NoSQL query">

<meta property="og:site_name" content="Yathit" />
<meta property="og:title" content="
  
    Compound index
  
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/ydn-db/" />
<meta property="og:image" content="/ydn-db/imgs/logo.png" />

<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/iccdnijlhdogaccaiafdpjmbakdcdakk">
<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/ldikiokclnbceabnlbkabmcacpiednop">

<link rel="stylesheet" media="screen" href="/css/styles.min.css" />

<script src="/js/analytics.js"></script>

  </head>

  <body class="page-doc page--article article--ydndb-query theme--ydndb-query" itemscope itemtype="http://schema.org/TechArticle">
    

    <header class="main-header">

	























<nav class="main-nav">

  <header class="main-nav__header">
    <span class="main-nav__current-label">Compound index</span>
  </header>

  <ul class="main-nav__list clear">
  
    
    
    <li class="main-nav__item main-nav__item--<strong>ydn-db</strong>
                main-nav__item--home 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/index.html" title="Go to <strong>YDN-DB</strong>">

        <strong>YDN-DB</strong>

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--download
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/downloads.html" title="Go to Download">

        Download

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--documentation
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/doc/index.html" title="Go to Documentation">

        Documentation

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--api
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/api/ydn/db/storage.html" title="Go to API">

        API

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--examples
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="//dev.yathit.com/ydn-db/doc/example/index.html" title="Go to Examples">

        Examples

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--github
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="https://github.com/yathit/ydn-db" title="Go to GitHub">

        GitHub

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  

  <li class="main-nav__item right">
    <a class="main-nav__link main-nav__link--parent" id="user-login">...</a>
  </li>
  <li class="main-nav__item right">
    <span class="main-nav__link main-nav__link--parent" id="user-name" style="display: none;"></span>
  </li>

  </ul>
  <button class="main-nav__btn btn--toggle-nav">
    <i class="icon icon-menu"></i>
  </button>

</nav>


</header>


    <div class="article-container" itemprop="text">

       <div class="ydn-breadcrumb-before"></div>
        <div class="container">
           <div class="content">
             <div id="ydn-breadcrumb" name="ydndb-doc"></div>
           </div>
        </div>
        <div class="ydn-breadcrumb-after"></div>

      <div class="editorial-header">
        <div class="container">
          <div class="content">

            <h1 class="editorial-header__title"></h1>
            <h2 class="editorial-header__subtitle" itemprop="name">Compound index</h2>

            <p class="editorial-header__excerpt" itemprop="headline">The IndexedDB API provides compound indexes to make complex queries possible.</p>

          </div>
        </div>
      </div>


      <div class="container"><div class="content ">

    <p>A <a href="http://en.wikipedia.org/wiki/Compound_key">compound key</a> is a key that consists of two or more attributes that uniquely identify an entity occurrence. In IndexedDB, a compound key can be created in an index from either a <a href="http://www.w3.org/TR/IndexedDB/#key-path-construct">keyPath</a> array or from a  <a href="http://www.w3.org/TR/IndexedDB/#key-construct">key</a> array as described in <a href="../setup/key.html#nested-set-model">Nested Set Model</a>. </p>

    <p>A compound index is created by providing a keyPath array in the <a href="/ydn-db/api/ydn/db/schema.html#Store">schema store</a> section. For example, the <a href="/js/ydn-db/data-seeding.js">data-seeding.js</a> file’s <code>'company_store_schema'</code> uses compound indexes extensively for querying. </p>

  </div>
</div>

<div class="highlight-module  highlight-module--right   highlight-module--remember   highlight-module--inline ">
  <div class="highlight-module__container  icon-exclamation ">
    <div class="highlight-module__content   g-wide--pull-1 highlight-module__inline ">
      <p class="highlight-module__title"> Tip</p>

      

      
        <ul class="highlight-module__list">
        
          <li>Pages in this section include the YDN-DB script and some preloaded data and utility functions.  You can follow the sample code in your browser's developer console to see in action.</li>
        
          <li>Your database will have to be loaded with sample data as described in section home page.</li>
        
        </ul>
      

    </div>
  </div>
</div>

<div class="container">
  <div class="content">

    <p>Suppose you want to filter the ‘license’ and ‘publisher’ fields of the ‘article’ store.  You can index both fields into a composite index by specifying a keyPath array as follows:</p>

    <pre><code>var schema = {
  store: [{
    name: 'article',
    indexes: [{
      name: 'license, publisher',
      keyPath: ['license', 'publisher']
    }]
  }]
};
</code></pre>

    <p>The index value is an array of two elements: the first element is the ‘license’ field and the second element is the ‘publisher’ field of the record. The key comparison algorithm ensures that results are sorted by license followed by publisher and iterates through the index in this order. If we filter ‘license’ to ‘SA’, we get the results sorted by publisher as follows:</p>

    <pre><code>key_range = ydn.db.KeyRange.starts(['SA']);
db.values(new ydn.db.IndexValueIterator('article', 'license, publisher', key_range), 10).done(function(articles) {
    console.log(articles); 
  }
);
</code></pre>

    <p>Notice that we keep the ‘license’ field constant to get the ‘publisher’ field sorted.   Alternately, we can filter ‘publisher’ by range.      </p>

    <pre><code>key_range = ydn.db.KeyRange.bound(['SA', 'A'], ['SA', 'B']);
db.values(new ydn.db.IndexValueIterator('article', 'license, publisher', key_range)).done(function(articles) {
    console.log(articles); 
  }
);
</code></pre>

    <p>Only the last field in an index can be filtered by a range in index query. Keep this limitation in mind.</p>

    <p>It is not possible to use this index to filter by ‘publisher’ and sort by ‘license’. That requires another index of <code>['publisher', 'license']</code>. This limits compound index use in ad hoc queries.</p>

    <p>Note that the list method does not have an offset when using an iterator. This is by design to improve performance and robustness: skipping a number of records is not fast for a large offset value. Also, you cannot be sure that the number of records does not change during execution of the query. The iterator saves the current position so it can resume from that position.  If you are using views to page through results, invoke the list again with the existing iterator to page to the next view. The position can even be be persisted to storage and resumed at a later time. To reverse the direction of the results, use <code>reverse</code> method of the iterator.</p>

    <p>Queries using a compound index take only logarithmic time on object store records: it is very fast.  Writing data with indexes requires more CPU time and extra storage for the indexes. Queries have to be planned before indexing and queries are limited to one range filter.  Multiple sort orders are supported.</p>

  </div></div>


      <div class="container clear-both">
        <div class="content">

          <div class="container-medium">
  <nav class="article-nav">
  
  
    <a class="article-nav-link article-nav-link--next" title="Next article" href="/ydn-db/doc/query/key-joining.html" style="float: right;">
      Next 'Key joining'
    </a>
  
  </nav>
</div>


          <br /><div class="g-comments" data-href=""></div>
        </div>
      </div>



      
        





      
      


<script src="/jsc/ydn.db-dev.js"></script>

    </div> <!-- /.article-container -->
    <div class="container clear">
	<div id="gc-content-license" class="gc-content-license g-wide--3 g-wide--last" >
		
		<div class="container clear">
	<div class="g-wide--3 g-wide--last">
    
		<h4>Authors</h4>
		
		
    <a href="/resources/contributors/index.html#kyawtun">
      Kyaw Tun</a>
		
    
	</div>
</div>

	</div>
</div>

    <footer class="main-footer">
  <div class="main-footer__container container clear">
    <div class="main-footer__list-group">
      <ul class="main-footer__list main-footer__list--primary">
      

        

        
        <li class="sitemap__item sitemap__item--<strong>ydn-db</strong>  sitemap__item--home  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/index.html" title="Go to <strong>YDN-DB</strong>">
            <strong>YDN-DB</strong>
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--download  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/downloads.html" title="Go to Download">
            Download
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--documentation  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/doc/index.html" title="Go to Documentation">
            Documentation
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--api  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/api/ydn/db/storage.html" title="Go to API">
            API
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--examples  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="//dev.yathit.com/ydn-db/doc/example/index.html" title="Go to Examples">
            Examples
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--github  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="https://github.com/yathit/ydn-db" title="Go to GitHub">
            GitHub
          </a>
        </li>
        
      
      </ul>

      <div class="main-footer__google-section">
        <h3 class="main-footer__title"><a href="/ydn-db/">
          <img id="developers-logo-footer" src="/imgs/yathit-dev-network.svg" alt="Yathit Developer Network logo">
        </a></h3>
        <ul class="main-footer__list main-footer__list--secondary google-list">
          <li><a href="https://www.yathit.com/">Yathit</a></li>
          <li><a href="https://www.yathit.com/terms.html">Terms of Service</a></li>
          <li><a href="https://www.yathit.com/privacy.html">Privacy Policy</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>

    <script src="/jsc/prettify.js"></script>

    
<script src="/js/script.js"></script>
<script src="/jsc/website-app.js"></script>
<script src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>





  </body>
</html>

