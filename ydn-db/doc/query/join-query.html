
<!DOCTYPE html>
<html lang="en" class="no-js no-touch">
  <head>

    <link type="text/css" rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro">
    
<meta charset="utf-8" />


<title>
  
    Join query
  
</title>





<meta name="author" content="https://plus.google.com/+KyawTun-Yathit/posts" />



<meta name="description" content="Join Query" />


<link rel="icon" href="/favicon.ico" />

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta id="viewport" name="viewport" content="width=device-width, initial-scale=1" />

<meta name="twitter:card" content="summary">
<meta property="twitter:account_id" content="@yathit" />
<meta property="twitter:site" content="@yathit" />
<meta property="twitter:description" content="Join Query" />
<meta property="twitter:creator" content="@yathit" />
<meta property="twitter:image:src" content="http://dev.yathit.com/imgs/logo.png" />


<link rel="author" href="https://plus.google.com/+KyawTun-Yathit/posts">
<link rel="publisher" href="https://plus.google.com/+KyawTun-Yathit">

<meta itemprop="name" content="
  
    Join query
  
">
<link itemprop="image" href="/imgs/logo.png">
<meta itemprop="description" content="Join Query">

<meta property="og:site_name" content="Yathit" />
<meta property="og:title" content="
  
    Join query
  
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://dev.yathit.com/" />
<meta property="og:image" content="http://dev.yathit.com/imgs/logo.png" />

<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/iccdnijlhdogaccaiafdpjmbakdcdakk">
<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/ldikiokclnbceabnlbkabmcacpiednop">

<link rel="stylesheet" media="screen" href="/css/styles.min.css" />

<script src="/js/analytics.js"></script>

  </head>

  <body class="page-doc page--article article--ydndb-query theme--ydndb-query" itemscope itemtype="http://schema.org/TechArticle">
    

    <header class="main-header">

	























<nav class="main-nav">

  <header class="main-nav__header">
    <span class="main-nav__current-label">Join query</span>
  </header>

  <ul class="main-nav__list clear">
  
    
    
    <li class="main-nav__item main-nav__item--<strong>ydn-db</strong>
                main-nav__item--home 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/index.html" title="Go to <strong>YDN-DB</strong>">

        <strong>YDN-DB</strong>

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--download
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/downloads.html" title="Go to Download">

        Download

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--documentation
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/doc/index.html" title="Go to Documentation">

        Documentation

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--api
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/api/ydn/db/storage.html" title="Go to API">

        API

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--examples
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="//dev.yathit.com/ydn-db/doc/example/index.html" title="Go to Examples">

        Examples

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--github
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="https://github.com/yathit/ydn-db" title="Go to GitHub">

        GitHub

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  

  <li class="main-nav__item right">
    <a class="main-nav__link main-nav__link--parent" id="user-login">...</a>
  </li>
  <li class="main-nav__item right">
    <span class="main-nav__link main-nav__link--parent" id="user-name" style="display: none;"></span>
  </li>

  </ul>
  <button class="main-nav__btn btn--toggle-nav">
    <i class="icon icon-menu"></i>
  </button>

</nav>


</header>


    <div class="article-container" itemprop="text">

       <div class="ydn-breadcrumb-before"></div>
        <div class="container">
           <div class="content">
             <div id="ydn-breadcrumb" name="ydndb-doc"></div>
           </div>
        </div>
        <div class="ydn-breadcrumb-after"></div>

      <div class="editorial-header">
        <div class="container">
          <div class="content">

            <h1 class="editorial-header__title"></h1>
            <h2 class="editorial-header__subtitle" itemprop="name">Join query</h2>

            <p class="editorial-header__excerpt" itemprop="headline">YDN-DB has facility for joining tables.</p>

          </div>
        </div>
      </div>


      <div class="container"><div class="content ">

    <p><a href="key-joining.html">Key-joining algorithms</a> were explained in the previous article. We will use these algorithm for joining multiple tables.</p>

    <h3 id="sample-data">Sample data</h3>

    <p>Load the very simple database used by Chris Date and Hugh Darwen for examples throughout their books (e.g., <a href="http://c2.com/cgi/wiki?AnIntroductionToDatabaseSystems">An Introduction To Database Systems</a> and <a href="http://en.wikipedia.org/wiki/The_Third_Manifesto">The Third Manifesto</a>).</p>

    <pre><code>var schema = {
  stores: [{
    name: 'Supplier',
    keyPath: 'SID',
    indexes: [{
      name: 'SNAME'
    }, {
      name: 'STATUS'
    }, {
      name: 'CITY'
    }]
  }, {
   name: 'Part',
   keyPath: 'PID',
   indexes: [{
     name: 'PNAME'
   }, {
     name: 'COLOR'
   }, {
     name: 'WEIGHT'
   }, {
     name: 'CITY'
   }]
  }, {
    name: 'Part-Supplier',
    autoIncrement: true,
    indexes: [{
      name: 'SID'
    }, {
      name: 'PID'
    }, {
      name: 'QTY'
    }]
  }]
};
var db = new ydn.db.Storage('supplier-part', schema);
db.put('Supplier', [
  {SID: "S1", SNAME: "Smith", STATUS: 20, CITY: "London"},
  {SID: "S2", SNAME: "Jones", STATUS: 10, CITY: "Paris"},
  {SID: "S3", SNAME: "Blake", STATUS: 30, CITY: "Paris"},
  {SID: "S4", SNAME: "Clark", STATUS: 20, CITY: "London"},
  {SID: "S5", SNAME: "Adams", STATUS: 30, CITY: "Athens"}
]);
db.put('Part', [
  {PID: "P1", PNAME: "Nut", COLOR: "Red", WEIGHT: 12.0, CITY: "London"},
	{PID: "P2", PNAME: "Bolt", COLOR: "Green", WEIGHT: 17.0, CITY: "Paris"},
	{PID: "P3", PNAME: "Screw", COLOR: "Blue", WEIGHT: 17.0, CITY: "Oslo"},
	{PID: "P4", PNAME: "Screw", COLOR: "Red", WEIGHT: 14.0, CITY: "London"},
	{PID: "P5", PNAME: "Cam", COLOR: "Blue", WEIGHT: 12.0, CITY: "Paris"},
	{PID: "P6", PNAME: "Cog", COLOR: "Red", WEIGHT: 19.0, CITY: "London"}
]);
db.put('Part-Supplier', [
  {SID: "S1", PID: "P1", QTY: 300},
	{SID: "S1", PID: "P2", QTY: 200},
	{SID: "S1", PID: "P3", QTY: 400},
	{SID: "S1", PID: "P4", QTY: 200},
	{SID: "S1", PID: "P5", QTY: 100},
	{SID: "S1", PID: "P6", QTY: 100},
	{SID: "S2", PID: "P1", QTY: 300},
	{SID: "S2", PID: "P2", QTY: 400},
	{SID: "S3", PID: "P2", QTY: 200},
	{SID: "S4", PID: "P2", QTY: 200},
	{SID: "S4", PID: "P4", QTY: 300},
	{SID: "S4", PID: "P5", QTY: 400}
]);
</code></pre>

    <h2 id="join-operation-using-a-full-table-scan">Join operation using a full table scan</h2>

    <p>A full table scan looks through all of the rows in a table – one by one – to find the data that a query is looking for. Obviously, this can cause very slow queries if you have a table with a lot of rows – just imagine how performance-intensive a full table scan would be on a table with millions of rows.Using an index can help prevent full table scans.</p>

    <p>There are some scenarios in which a full table scan will still be performed even though an index is present on that table. Here are some of those scenarios:</p>

    <ol>
      <li>You choose not to index the fields. A full table scan does not require indexing.</li>
      <li>You use regular expressions or complex filtering in the query.  For example, a query like <code>WHERE NAME LIKE ‘%INTERVIEW%</code> cannot be use an index.</li>
      <li>You query with multiple ranges.</li>
    </ol>

    <p>This example uses a full table scan in YDN-DB for the query <code>SELECT * FROM Supplier, Part WHERE Supplier.CITY = Part.CITY</code>.  The<a href="http://dev.yathit.com/api/ydn/db/storage.html#scan"><code>db.scan</code></a> method is used to scan multiple tables at the same time. The code snippet uses a nested loop, in which inner table does a full table scan for each outer table record:</p>

    <pre><code>var iter_supplier = new ydn.db.ValueIterator('Supplier');
var iter_part = new ydn.db.ValueIterator('Part');
var req = db.scan(function(keys, values) {
  var SID = keys[0];
  var PID = keys[1];
  console.log(SID, PID);
  if (SID &amp;&amp; PID) {
    if (values[0].CITY == values[1].CITY) {
      console.log(values[0], values[1]);
    }
    return [undefined, true]; // advance inner loop
  } else if (!PID) {
    return [true, false]; // advance outer loop, restart inner loop
  } else {
    return []; // done
  }
}, [iter_supplier, iter_part]);
</code></pre>

    <h2 id="index-base-joining">Index base joining</h2>

    <p>We can use indexes for more efficient joining.  Here is the same query with indexes:</p>

    <pre><code>var iter_supplier = new ydn.db.IndexValueIterator('Supplier', 'CITY');
var iter_part = new ydn.db.IndexValueIterator('Part', 'CITY');
var req = db.scan(function(keys, values) {
  var SID = keys[0];
  var PID = keys[1];
  console.log(SID, PID);
  if (!SID || !PID) {
    return []; // done
  }
  var cmp = ydn.db.cmp(SID, PID); // compare keys
  if (cmp == 0) {
    console.log(values[0], values[1]);
    return [true, true]; // advance both
  } else if (cmp == 1) {
    return [undefined, SID]; // jump PID cursor to match SID
  } else {
    return [PID, undefined]; // jump SID cursor to match PID
  }
}, [iter_supplier, iter_part]);
</code></pre>

    <p>Notice that we only need to scan through the indexes once to find matching records and we do not scan the table.  The total size of records in these two tables does not matter, only the matching records are relevant. The index base joining technique is very scalable.</p>

  </div></div>


      <div class="container clear-both">
        <div class="content">

          <div class="container-medium">
  <nav class="article-nav">
  
    <a class="article-nav-link article-nav-link--prev" title="Previous article" href="/ydn-db/doc/query/key-joining.html">
      Previous 'Key joining'
    </a>
  
  
    <a class="article-nav-link article-nav-link--next" title="Next article" href="/ydn-db/doc/query/multi-query.html" style="float: right;">
      Next 'Multi query'
    </a>
  
  </nav>
</div>


          <br /><div class="g-comments" data-href=""></div>
        </div>
      </div>



      
        





      
      


<script src="/jsc/ydn.db-dev.js"></script>

    </div> <!-- /.article-container -->
    <div class="container clear">
	<div id="gc-content-license" class="gc-content-license g-wide--3 g-wide--last" >
		
		<div class="container clear">
	<div class="g-wide--3 g-wide--last">
    
		<h4>Authors</h4>
		
		
    <a href="/resources/contributors/index.html#kyawtun">
      Kyaw Tun</a>
		
    
	</div>
</div>

	</div>
</div>

    <footer class="main-footer">
  <div class="main-footer__container container clear">
    <div class="main-footer__list-group">
      <ul class="main-footer__list main-footer__list--primary">
      

        

        
        <li class="sitemap__item sitemap__item--<strong>ydn-db</strong>  sitemap__item--home  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/index.html" title="Go to <strong>YDN-DB</strong>">
            <strong>YDN-DB</strong>
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--download  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/downloads.html" title="Go to Download">
            Download
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--documentation  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/doc/index.html" title="Go to Documentation">
            Documentation
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--api  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/api/ydn/db/storage.html" title="Go to API">
            API
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--examples  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="//dev.yathit.com/ydn-db/doc/example/index.html" title="Go to Examples">
            Examples
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--github  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="https://github.com/yathit/ydn-db" title="Go to GitHub">
            GitHub
          </a>
        </li>
        
      
      </ul>

      <div class="main-footer__google-section">
        <h3 class="main-footer__title"><a href="http://dev.yathit.com/">
          <img id="developers-logo-footer" src="/imgs/yathit-dev-network.svg" alt="Yathit Developer Network logo">
        </a></h3>
        <ul class="main-footer__list main-footer__list--secondary google-list">
          <li><a href="https://www.yathit.com/">Yathit</a></li>
          <li><a href="https://www.yathit.com/terms.html">Terms of Service</a></li>
          <li><a href="https://www.yathit.com/privacy.html">Privacy Policy</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>

    <script src="/jsc/prettify.js"></script>

    
<script src="/js/script.js"></script>
<script src="/jsc/website-app.js"></script>
<script src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>





  </body>
</html>

