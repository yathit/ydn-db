
<!DOCTYPE html>
<html lang="en" class="no-js no-touch">
  <head>

    <link type="text/css" rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro">
    
<meta charset="utf-8" />


<title>
  
    Multi query
  
</title>





<meta name="author" content="https://plus.google.com/+KyawTun-Yathit/posts" />



<meta name="description" content="Multi query in indexeddb" />


<link rel="icon" href="/favicon.ico" />

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta id="viewport" name="viewport" content="width=device-width, initial-scale=1" />

<meta name="twitter:card" content="summary">
<meta property="twitter:account_id" content="@yathit" />
<meta property="twitter:site" content="@yathit" />
<meta property="twitter:description" content="Multi query in indexeddb" />
<meta property="twitter:creator" content="@yathit" />
<meta property="twitter:image:src" content="/ydn-db/imgs/logo.png" />


<link rel="author" href="https://plus.google.com/+KyawTun-Yathit/posts">
<link rel="publisher" href="https://plus.google.com/+KyawTun-Yathit">

<meta itemprop="name" content="
  
    Multi query
  
">
<link itemprop="image" href="/imgs/logo.png">
<meta itemprop="description" content="Multi query in indexeddb">

<meta property="og:site_name" content="Yathit" />
<meta property="og:title" content="
  
    Multi query
  
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/ydn-db/" />
<meta property="og:image" content="/ydn-db/imgs/logo.png" />

<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/iccdnijlhdogaccaiafdpjmbakdcdakk">
<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/ldikiokclnbceabnlbkabmcacpiednop">

<link rel="stylesheet" media="screen" href="/css/styles.min.css" />

<script src="/js/analytics.js"></script>

  </head>

  <body class="page-doc page--article article--ydndb-query theme--ydndb-query" itemscope itemtype="http://schema.org/TechArticle">
    

    <header class="main-header">

	























<nav class="main-nav">

  <header class="main-nav__header">
    <span class="main-nav__current-label">Multi query</span>
  </header>

  <ul class="main-nav__list clear">
  
    
    
    <li class="main-nav__item main-nav__item--<strong>ydn-db</strong>
                main-nav__item--home 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/index.html" title="Go to <strong>YDN-DB</strong>">

        <strong>YDN-DB</strong>

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--download
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/downloads.html" title="Go to Download">

        Download

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--documentation
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/doc/index.html" title="Go to Documentation">

        Documentation

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--api
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/api/ydn/db/storage.html" title="Go to API">

        API

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--examples
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="//dev.yathit.com/ydn-db/doc/example/index.html" title="Go to Examples">

        Examples

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--github
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="https://github.com/yathit/ydn-db" title="Go to GitHub">

        GitHub

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  

  <li class="main-nav__item right">
    <a class="main-nav__link main-nav__link--parent" id="user-login">...</a>
  </li>
  <li class="main-nav__item right">
    <span class="main-nav__link main-nav__link--parent" id="user-name" style="display: none;"></span>
  </li>

  </ul>
  <button class="main-nav__btn btn--toggle-nav">
    <i class="icon icon-menu"></i>
  </button>

</nav>


</header>


    <div class="article-container" itemprop="text">

       <div class="ydn-breadcrumb-before"></div>
        <div class="container">
           <div class="content">
             <div id="ydn-breadcrumb" name="ydndb-doc"></div>
           </div>
        </div>
        <div class="ydn-breadcrumb-after"></div>

      <div class="editorial-header">
        <div class="container">
          <div class="content">

            <h1 class="editorial-header__title"></h1>
            <h2 class="editorial-header__subtitle" itemprop="name">Multi query</h2>

            <p class="editorial-header__excerpt" itemprop="headline">Union of multiple query results.</p>

          </div>
        </div>
      </div>


      <div class="container"><div class="content ">

    <p>YDN-DB provides method for running multiple query in parallel, allowing for executing <code>IN</code> query in SQL syntax.</p>

    <p>Consider the following query, <code>SELECT * FROM article WHERE topics IN ("object-relational mapper", "open source") LIMIT 10</code></p>

    <p>Create iterator each for all element of IN condition clause.</p>

    <pre><code>var iter_0 = ydn.db.IndexIterator.where('article', 'topics', '=', 'object-relational mapper');
var iter_1 = ydn.db.IndexIterator.where('article', 'topics', '=', 'open source');
</code></pre>

    <p>Create multi query function, which keep resulting primary keys and advance cursor(s) on each cursor iterator in such a way that, cursor(s) is advance for next primary key.</p>

    <pre><code>var keys = [];
var multiQuery = function(sec_keys, pri_keys) {
  var advance = [];
  var cmp = ydn.db.cmp(pri_keys[0], pri_keys[1]);
  if (cmp == 1) { // pri_keys[0] &gt; pri_keys[1]
    if (keys[keys.length - 1] != pri_keys[1]) {
      keys.push(pri_keys[1]);
    }
    advance[1] = true; // advance iter_1 on step
  } else if (cmp == -1) { // pri_keys[0] &lt; pri_keys[1]
    if (keys[keys.length - 1] != pri_keys[0]) {
      keys.push(pri_keys[0]);
    }
    advance[1] = true; // advance iter_1 on step
  } else { // pri_keys[0] == pri_keys[1]
    if (keys[keys.length - 1] != pri_keys[0]) {
      keys.push(pri_keys[0]);
    }
    advance[0] = true; // advance iter_0 on step
    advance[1] = true; // advance iter_1 on step
  }

  if (keys.length &gt;= 10) {
    return [];
  } else {
    return advance;
  }
};
</code></pre>

    <p>Open database if not done so. You must load the data as described in <a href="index.html">overview</a> section.</p>

    <pre><code>var db = new ydn.db.Storage('nosql-query');
</code></pre>

    <p>Here, scanning query is performed using <code>scan</code> method. Notice that after key scanning, function record value are retrieve by <code>values</code> method.</p>

    <pre><code>db.scan(multiQuery, [iter_0, iter_1]).done(function() {
  db.values('article', keys).done(function(values) {
    console.log(keys, values);
  })
});
</code></pre>

  </div>
</div>

<div class="highlight-module  highlight-module--right   highlight-module--remember   highlight-module--inline ">
  <div class="highlight-module__container  icon-exclamation ">
    <div class="highlight-module__content   g-wide--pull-1 highlight-module__inline ">
      <p class="highlight-module__title"> Tip</p>

      
        <p class="highlight-module__text"> Pages in this sections include the YDN-DB script, so that you follow the sample code in your browser's developer console to see in action. </p>
      

      

    </div>
  </div>
</div>

<div class="container">
  <div class="content">

    <p>We can resume the query from the previous by issue the query again. It is possible to reverse the query by changing the sing inside <code>multiQuery</code> function. These are patterns for pagination in ydn-db query, which does not use offset.</p>

    <p><code>scan</code> method is very general and can be combine with <a href="key-joining.html">key joining algorithm</a> described previously. It should be notice that multi-query is <a href="http://en.wikipedia.org/wiki/Logical_disjunction">logical disjunction, OR</a>, while key joining is <a href="http://en.wikipedia.org/wiki/Logical_conjunction">logical conjunction, AND</a>.</p>

    <p><a href="http://en.wikipedia.org/wiki/Negation">Negation, NOT</a> is implemented by multiple query of open lower bound key range and open upper bound key range query. For example, the query <code>SELECT * FROM article WHERE topics != "open source"</code> is result of multi query of iterators <code>ydn.db.IndexIterator.where('article', 'topics', '&gt;', 'open source')</code> and <code>ydn.db.IndexIterator.where('article', 'topics', '&lt;', 'open source')</code>.</p>

    <p>By re-writing query into <a href="http://en.wikipedia.org/wiki/Canonical_normal_form">canonical normal form</a>,  combination of these queries can be executed. There are no limit in number of query, but only one range query can be in the combination. For more detail about these query see Alfred Fuller’s <a href="https://www.youtube.com/watch?v=ofhEyDBpngM">Next gen queries</a> in Google I/0 2010.</p>

  </div></div>


      <div class="container clear-both">
        <div class="content">

          <div class="container-medium">
  <nav class="article-nav">
  
    <a class="article-nav-link article-nav-link--prev" title="Previous article" href="/ydn-db/doc/query/join-query.html">
      Previous 'Join query'
    </a>
  
  
    <a class="article-nav-link article-nav-link--next" title="Next article" href="/ydn-db/doc/query/sql-query.html" style="float: right;">
      Next 'SQL'
    </a>
  
  </nav>
</div>


          <br /><div class="g-comments" data-href=""></div>
        </div>
      </div>



      
        





      
      


<script src="/jsc/ydn.db-dev.js"></script>

    </div> <!-- /.article-container -->
    <div class="container clear">
	<div id="gc-content-license" class="gc-content-license g-wide--3 g-wide--last" >
		
		<div class="container clear">
	<div class="g-wide--3 g-wide--last">
    
		<h4>Authors</h4>
		
		
    <a href="/resources/contributors/index.html#kyawtun">
      Kyaw Tun</a>
		
    
	</div>
</div>

	</div>
</div>

    <footer class="main-footer">
  <div class="main-footer__container container clear">
    <div class="main-footer__list-group">
      <ul class="main-footer__list main-footer__list--primary">
      

        

        
        <li class="sitemap__item sitemap__item--<strong>ydn-db</strong>  sitemap__item--home  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/index.html" title="Go to <strong>YDN-DB</strong>">
            <strong>YDN-DB</strong>
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--download  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/downloads.html" title="Go to Download">
            Download
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--documentation  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/doc/index.html" title="Go to Documentation">
            Documentation
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--api  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/api/ydn/db/storage.html" title="Go to API">
            API
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--examples  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="//dev.yathit.com/ydn-db/doc/example/index.html" title="Go to Examples">
            Examples
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--github  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="https://github.com/yathit/ydn-db" title="Go to GitHub">
            GitHub
          </a>
        </li>
        
      
      </ul>

      <div class="main-footer__google-section">
        <h3 class="main-footer__title"><a href="/ydn-db/">
          <img id="developers-logo-footer" src="/imgs/yathit-dev-network.svg" alt="Yathit Developer Network logo">
        </a></h3>
        <ul class="main-footer__list main-footer__list--secondary google-list">
          <li><a href="https://www.yathit.com/">Yathit</a></li>
          <li><a href="https://www.yathit.com/terms.html">Terms of Service</a></li>
          <li><a href="https://www.yathit.com/privacy.html">Privacy Policy</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>

    <script src="/jsc/prettify.js"></script>

    
<script src="/js/script.js"></script>
<script src="/jsc/website-app.js"></script>
<script src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>





  </body>
</html>

