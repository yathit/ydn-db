
<!DOCTYPE html>
<html lang="en" class="no-js no-touch" itemscope itemtype="http://schema.org/Article">
  <head>

    
<meta charset="utf-8" />


<title>
  
    Query
  
</title>







<meta name="description" content="YDN-DB library query in-depth." />


<link rel="icon" href="/favicon.ico" />

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta id="viewport" name="viewport" content="width=device-width, initial-scale=1" />

<meta name="twitter:card" content="summary">
<meta property="twitter:account_id" content="@yathit" />
<meta property="twitter:site" content="@yathit" />
<meta property="twitter:description" content="YDN-DB library query in-depth." />
<meta property="twitter:creator" content="@yathit" />
<meta property="twitter:image:src" content="/ydn-db/imgs/logo.png" />



<link rel="publisher" href="https://plus.google.com/+KyawTun-Yathit">

<meta itemprop="name" content="
  
    Query
  
">
<link itemprop="image" href="/imgs/logo.png">
<meta itemprop="description" content="YDN-DB library query in-depth.">

<meta property="og:site_name" content="Yathit" />
<meta property="og:title" content="
  
    Query
  
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/ydn-db/" />
<meta property="og:image" content="/ydn-db/imgs/logo.png" />

<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/iccdnijlhdogaccaiafdpjmbakdcdakk">
<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/ldikiokclnbceabnlbkabmcacpiednop">

<link rel="stylesheet" media="screen" href="/css/styles.min.css" />

<script src="/js/analytics.js"></script>

  </head>

  <body class="page-doc article--ydndb-doc theme--ydndb-doc">
    

    <header class="main-header">

	























<nav class="main-nav">

  <header class="main-nav__header">
    <span class="main-nav__current-label">Query</span>
  </header>

  <ul class="main-nav__list clear">
  
    
    
    <li class="main-nav__item main-nav__item--<strong>ydn-db</strong>
                main-nav__item--home 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/index.html" title="Go to <strong>YDN-DB</strong>">

        <strong>YDN-DB</strong>

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--download
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/downloads.html" title="Go to Download">

        Download

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--documentation
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/doc/index.html" title="Go to Documentation">

        Documentation

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--api
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/api/ydn/db/storage.html" title="Go to API">

        API

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--examples
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="//dev.yathit.com/ydn-db/doc/example/index.html" title="Go to Examples">

        Examples

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--github
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="https://github.com/yathit/ydn-db" title="Go to GitHub">

        GitHub

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  

  <li class="main-nav__item right">
    <a class="main-nav__link main-nav__link--parent" id="user-login">...</a>
  </li>
  <li class="main-nav__item right">
    <span class="main-nav__link main-nav__link--parent" id="user-name" style="display: none;"></span>
  </li>

  </ul>
  <button class="main-nav__btn btn--toggle-nav">
    <i class="icon icon-menu"></i>
  </button>

</nav>


</header>


    <div class="article-container">
      <div class="editorial-header">
        <div class="container">
          <div class="content">

            <div class="ydn-breadcrumb-before"></div>
            <div id="ydn-breadcrumb" name="ydndb-doc"></div>
            <div class="ydn-breadcrumb-after"></div>

            <h1 class="editorial-header__title"></h1>
            <h2 class="editorial-header__subtitle">Query</h2>

            <p class="editorial-header__excerpt">YDN-DB library query in-depth.</p>

          </div>
        </div>
      </div>

      <div class="container-medium">
  <div class="guides" data-current-lesson="0">
    <h3><i class="icon icon-lessons"></i> Guides</h3>
    <ol class="list-guides list-links">
      
        <li title="Compound index">
          <a href="/ydn-db/doc/query/cmpidx.html">Compound index</a>
        </li>
      
        <li title="Key joining">
          <a href="/ydn-db/doc/query/key-joining.html">Key joining</a>
        </li>
      
        <li title="Join query">
          <a href="/ydn-db/doc/query/join-query.html">Join query</a>
        </li>
      
        <li title="Multi query">
          <a href="/ydn-db/doc/query/multi-query.html">Multi query</a>
        </li>
      
        <li title="SQL">
          <a href="/ydn-db/doc/query/sql-query.html">SQL</a>
        </li>
      
    </ol>
  </div>
</div>

      <div class="container"><div class="content ">

    <p>IndexedDB is a key-document database with secondary indexes. SQL is decidedly absent from the IndexedDB API specification due to the difficultly in defining the SQL language. However efficiently database query remains in the IndexedDB API. We write queries with its rich, but limited, vocabulary, unambiguous grammar and syntax reminescent of the SQL language. The indexedDB API exposes only what is necessary for efficiently querying, i.e., how to query over a range of indexes. Working directly with indexes may sound clumsy, but it makes sense in JavasScript where responsiveness is paramount.  The Query API in indexedDB is simple: we either query by the primary key or a secondary key from an index. Query results are always returned one record at a time.</p>

    <p>In this section, we will describe how to query IndexedDB using the YDN-DB library. You will need to understand the <a href="../setup/schema.html">YDN-DB database schema</a> section, specifically defining <a href="../setup/index.html">indexes</a>.</p>

    <h3 id="test-data">Test data</h3>

    <script src="/js/ydn-db/data-seeding.js"></script>

  </div>
</div>

<div class="highlight-module  highlight-module--right   highlight-module--remember   highlight-module--inline ">
  <div class="highlight-module__container  icon-exclamation ">
    <div class="highlight-module__content   g-wide--pull-1 highlight-module__inline ">
      <p class="highlight-module__title"> Tip</p>

      
        <p class="highlight-module__text"> Pages in this section include the YDN-DB script and some preloaded data and utility functions.  You can follow the sample code in your browser's developer console to see in action. </p>
      

      

    </div>
  </div>
</div>

<div class="container">
  <div class="content">

    <p>Before starting, you should populate the database with some data based upon previous schema. Schema definition and random data generation are defined in the <a href="/ydn-db/js/ydn-db/data-seeding.js">data-seeding.js</a> file.</p>

    <pre><code>db = new ydn.db.Storage('nosql-query', author_article_topic_schema);

db.count('topic').done(function(cnt_topic) {
  var n_topics = 10;
  var n_authors = 100;
  var article_per_author = 10;
  if (cnt_topic &lt; n_topics) {
    var topics = topics = genTopics(n_topics);
    db.put('topic', topics).done(function(t_keys) {
      console.log(t_keys.length + ' topics added.');
      var authors = genAuthors(n_authors);
      var emails = authors.map(function(x) {return x.email;});
      var articles = genArticles(article_per_author*n_authors, t_keys);
      var article_keys = articles.map(function(x) {return pickOne(emails) + '/' + x.publish;});
      db.put('author', authors).done(function(x) {console.log(x.length + ' authors added.');});
      db.put('article', articles, article_keys).done(function(x) {console.log(x.length + ' articles added.');});
    });
  } else {
    console.log('db ready.');
  }
});
</code></pre>

    <p>The above code snippet generates three stores and randomly populates them with 10 topics, 100 authors and 1000 articles.  Here is an example of an author record and an article record:</p>

    <pre><code>author_1 = {
  email: 'me@aaronsw.com',
  born: 531763200000,
  first: 'Aaron',
  last: 'Swartz',
  company: 'Reddit',
  hobby: ['programming', 'blogging', 'politics']
};
article_1 = {
  title:"Database Processes for an Integrated Library System in a Class",
  content:"...",
  license:"NC",
  publisher:"Springer",
  publish:640022400000,
  topics:["object-relational mapper","website wireframe","distributed computing","dynamic systems development method","open source","integrated library system"]}
</code></pre>

    <p>The article store uses an out-of-line primary key which is a composite key composed of the parent key, the author’s email, and the publication date (publish field).  While a composite key is, ideally, an array of the composed keys, this just concatenates the fields to maintain compatibility with IE11. IE11 does not support array keys.</p>

    <h3 id="key-range-query-for-filtering-and-pagination">Key range query for filtering and pagination</h3>

    <p>One of the simplest, efficient, and common filter methods is the <a href="../setup/key.html#keyrange">key range</a> query. A key range query allows you to query a ordered set of records, optionally specifying a lower and upper bound of an indexed field. It is similar to WHERE clause in SQL.</p>

    <p>To query all records with the ‘license’ field value ‘SA’, use the <code>values</code> method as follows:</p>

    <pre><code>var key_range = ydn.db.KeyRange.only('SA');
db.values('article', 'license', key_range).then(function(record) {
    console.log(record);
  }, function(e) {
    console.error(e);
  }
);
</code></pre>

    <p>To query on the primary key, skip the index field name, e.g: <code>db.values('article', key_range)</code>.</p>

    <p>By default, the number of results is limited to 100. Limit and offset arguments can be specified after the key range arguments:</p>

    <pre><code>db.values('article', 'license', key_range, 10, 5).always(function(record) {
    console.log(record);
  }
);
</code></pre>

    <p>Pagination can be accomplished by using limit and offset.</p>

    <p>Results are ordered by secondary keys and then by primary keys.  In the above example, the primary key is a constant of ‘SA’, so the results are ordered by the secondary key.</p>

    <p>You can reverse the ordering with a boolean:</p>

    <pre><code> db.values('article', 'license', key_range, 10, 0, true).always(function(record) {
     console.log(record);
   }
 );
</code></pre>

    <p>If we just want to know the primary keys of records, use the <code>keys</code> method:</p>

    <pre><code>db.keys('article', 'license', key_range).always(function(record) {
    console.log(record);
  }
);
</code></pre>

    <p>The key range is essentially the WHERE clause in SQL. See <a href="../setup/key.html#keyrange">key range construction table</a> for a comparison to the WHERE clause.</p>

    <pre><code>SELECT * FROM article WHERE publish &gt;= 946656000000 AND publish &lt; 978278400000;
</code></pre>

    <p>The above SQL query is translated to a key range query as:</p>

    <pre><code>var kr = new ydn.db.KeyRange(946656000000, 978278400000, false, true);
db.values('article', 'publish', kr).always(function(record) {
    console.log(record);
  }
);
</code></pre>

    <p>The first two arguments in KeyRange constructor are its lower and upper bounds. The last two arguments indicate the bound is closed (<code>false</code>) or open (<code>true</code>) for the respective bounds. A closed bound includes the boundary value itself in the key range whereas an open bound does not.   </p>

    <h3 id="iterators">Iterators</h3>

    <p>An iterator can be used instead of a key range. An iterator specifies a continuous stream of records by combining a store name, index name and key range.</p>

    <pre><code>var limit = 10;
req = db.values(new ydn.db.IndexValueIterator('article', 'license', key_range), limit);
req.done(function(records) {
    console.log(records);
  }
);
</code></pre>

    <p>There are two type of iterators: key iterators and value iterators.  A value iterator references values in a record and requires serializaiton on retrieval.  A key iterator references only the indexed key and avoids the serializaiton cost. For example, we can retrieve all names starting with ‘M’ without the serialization cost of the records:</p>

    <pre><code>var key_range = ydn.db.KeyRange.starts('M');
req = db.keys(new ydn.db.IndexIterator('article', 'title', key_range), 10);
req.done(function(titles) {
    console.log(titles);
  }
);
</code></pre>

    <p>Note that the above query is not possible using the key range query syntax.</p>

    <h3 id="iterations">Iterations</h3>

    <p>There are situations that index-based queries are not possible or you simply don’t want the storage cost of an index. In these cases, all records in the store must be enumerated to find the desired result using the <a href="/ydn-db/api/ydn/db/storage.html#open">open method</a>:</p>

    <pre><code>var count = 0;
req = db.open(function(cursor) {
  var record = cursor.getValue();
  console.log(record.first + ' ' + record.last);
  count++;
}, new ydn.db.ValueIterator('author'));
req.done(function() {
  console.log(count + ' authors found.');
}, 'readonly');
</code></pre>

    <p>Opening can be invoked in <code>'readonly'</code> or <code>'readwrite'</code> mode.</p>

    <p>In general, queries involves filtering multiple fields, paging results, and choosing how results will be sorted. Complex queries are solved by using index, <a href="compound-index.html">compound index</a> and algorithmic <a href="key-joining.html">key joining</a> techniques.</p>

  </div></div>


      <div class="container clear-both">
        <div class="content">

          <div class="container-medium">
  <nav class="article-nav">
  
    <a class="article-nav-link article-nav-link--prev" title="Previous article" href="/ydn-db/doc/setup/index.html">
      Previous 'Getting started'
    </a>
  
  
    <a class="article-nav-link article-nav-link--next" title="Next article" href="/ydn-db/doc/usage/index.html" style="float: right;">
      Next 'Using YDN-DB'
    </a>
  
  </nav>
</div>


          <br /><div class="g-comments" data-href=""></div>
        </div>
      </div>

      


      







    </div> <!-- /.article-container -->

    <div class="container clear">
	<div id="gc-content-license" class="gc-content-license g-wide--3 g-wide--last" >
		
		<div class="container clear">
	<div class="g-wide--3 g-wide--last">
    
	</div>
</div>

	</div>
</div>

    <footer class="main-footer">
  <div class="main-footer__container container clear">
    <div class="main-footer__list-group">
      <ul class="main-footer__list main-footer__list--primary">
      

        

        
        <li class="sitemap__item sitemap__item--<strong>ydn-db</strong>  sitemap__item--home  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/index.html" title="Go to <strong>YDN-DB</strong>">
            <strong>YDN-DB</strong>
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--download  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/downloads.html" title="Go to Download">
            Download
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--documentation  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/doc/index.html" title="Go to Documentation">
            Documentation
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--api  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/api/ydn/db/storage.html" title="Go to API">
            API
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--examples  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="//dev.yathit.com/ydn-db/doc/example/index.html" title="Go to Examples">
            Examples
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--github  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="https://github.com/yathit/ydn-db" title="Go to GitHub">
            GitHub
          </a>
        </li>
        
      
      </ul>

      <div class="main-footer__google-section">
        <h3 class="main-footer__title"><a href="/ydn-db/">
          <img id="developers-logo-footer" src="/imgs/yathit-dev-network.svg" alt="Yathit Developer Network logo">
        </a></h3>
        <ul class="main-footer__list main-footer__list--secondary google-list">
          <li><a href="https://www.yathit.com/">Yathit</a></li>
          <li><a href="https://www.yathit.com/terms.html">Terms of Service</a></li>
          <li><a href="https://www.yathit.com/privacy.html">Privacy Policy</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>

    <script src="/jsc/prettify.js"></script>

    <script src="/jsc/ydn.db-dev.js"></script>
    
<script src="/js/script.js"></script>
<script src="/jsc/website-app.js"></script>
<script src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>





  </body>
</html>

