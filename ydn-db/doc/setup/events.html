
<!DOCTYPE html>
<html lang="en" class="no-js no-touch">
  <head>

    <link type="text/css" rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro">
    
<meta charset="utf-8" />


<title>
  
    Events
  
</title>





<meta name="author" content="https://plus.google.com/+KyawTun-Yathit/posts" />



<meta name="description" content="Database Key" />


<link rel="icon" href="/favicon.ico" />

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta id="viewport" name="viewport" content="width=device-width, initial-scale=1" />

<meta name="twitter:card" content="summary">
<meta property="twitter:account_id" content="@yathit" />
<meta property="twitter:site" content="@yathit" />
<meta property="twitter:description" content="Database Key" />
<meta property="twitter:creator" content="@yathit" />
<meta property="twitter:image:src" content="http://dev.yathit.com/imgs/logo.png" />


<link rel="author" href="https://plus.google.com/+KyawTun-Yathit/posts">
<link rel="publisher" href="https://plus.google.com/+KyawTun-Yathit">

<meta itemprop="name" content="
  
    Events
  
">
<link itemprop="image" href="/imgs/logo.png">
<meta itemprop="description" content="Database Key">

<meta property="og:site_name" content="Yathit" />
<meta property="og:title" content="
  
    Events
  
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://dev.yathit.com/" />
<meta property="og:image" content="http://dev.yathit.com/imgs/logo.png" />

<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/iccdnijlhdogaccaiafdpjmbakdcdakk">
<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/ldikiokclnbceabnlbkabmcacpiednop">

<link rel="stylesheet" media="screen" href="/css/styles.min.css" />

<script src="/js/analytics.js"></script>

  </head>

  <body class="page-doc page--article article--ydndb-setup theme--ydndb-setup" itemscope itemtype="http://schema.org/TechArticle">
    

    <header class="main-header">

	























<nav class="main-nav">

  <header class="main-nav__header">
    <span class="main-nav__current-label">Events</span>
  </header>

  <ul class="main-nav__list clear">
  
    
    
    <li class="main-nav__item main-nav__item--<strong>ydn-db</strong>
                main-nav__item--home 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/index.html" title="Go to <strong>YDN-DB</strong>">

        <strong>YDN-DB</strong>

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--download
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/downloads.html" title="Go to Download">

        Download

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--documentation
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/doc/index.html" title="Go to Documentation">

        Documentation

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--api
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/api/ydn/db/storage.html" title="Go to API">

        API

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--examples
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="//dev.yathit.com/ydn-db/doc/example/index.html" title="Go to Examples">

        Examples

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--github
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="https://github.com/yathit/ydn-db" title="Go to GitHub">

        GitHub

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  

  <li class="main-nav__item right">
    <a class="main-nav__link main-nav__link--parent" id="user-login">...</a>
  </li>
  <li class="main-nav__item right">
    <span class="main-nav__link main-nav__link--parent" id="user-name" style="display: none;"></span>
  </li>

  </ul>
  <button class="main-nav__btn btn--toggle-nav">
    <i class="icon icon-menu"></i>
  </button>

</nav>


</header>


    <div class="article-container" itemprop="text">

       <div class="ydn-breadcrumb-before"></div>
        <div class="container">
           <div class="content">
             <div id="ydn-breadcrumb" name="ydndb-doc"></div>
           </div>
        </div>
        <div class="ydn-breadcrumb-after"></div>

      <div class="editorial-header">
        <div class="container">
          <div class="content">

            <h1 class="editorial-header__title"></h1>
            <h2 class="editorial-header__subtitle" itemprop="name">Events</h2>

            <p class="editorial-header__excerpt" itemprop="headline">YDN-DB event module dispatch useful database events.</p>

          </div>
        </div>
      </div>


      <div class="container"><div class="content ">

    <h3 id="ydn-db-event-module">YDN-DB event module</h3>

    <p>YDN-DB is composed of <a href="setup.html#ydn-db-modules">several modules</a> and one of them is Event module. With event module, such as ‘ydn.db-iswu-core-e-qry-dev.js’, database instance dispatches four types of <a href="/api/ydn/db/events.html">events</a>. Responding to these events are necessary to handle very rare problem during database schema upgrading. </p>

    <h3 id="database-ready-event">Database ready event</h3>

    <p>When storage instance is connected and ready for use, it dispatch <code>'ready'</code> <a href="/api/ydn/db/events.html#StoreEvent">StorageEvent</a>. <code>'ready'</code> event is dispatch only once before connection time out interval (default to 30 seconds). All database requests must wait until <code>'ready'</code> state and push in request queue. Hence heavy database operation are requested only after ready as follow: </p>

    <pre><code>db.addEventListener('ready', function (event) {
  var is_updated = event.getVersion() != event.getOldVersion();
  if (is_updated) {
    console.log('database connected with new schema');
  } else if (isNaN(event.getOldVersion()))  {
    console.log('new database created');
  } else {
    console.log('existing database connected');
  }
  // heavy database operations should start from this.
);
</code></pre>

  </div>
</div>

<div class="highlight-module  highlight-module--right   highlight-module--remember   highlight-module--inline ">
  <div class="highlight-module__container  icon-exclamation ">
    <div class="highlight-module__content   g-wide--pull-1 highlight-module__inline ">
      <p class="highlight-module__title"> Tip</p>

      
        <p class="highlight-module__text"> Instead of listening 'ready' event, `onReady()` can be used as well. </p>
      

      

    </div>
  </div>
</div>

<div class="container">
  <div class="content">

    <p>The <code>'ready'</code> <code>StorageEvent</code>, has <code>getVersion()</code> and <code>getOldVersion()</code> methods to get current and old database version. If a new database is created, old version is <code>NaN</code>. If the existing database is upgraded to new schema, these two versions are different. By checking these values, migration logic can be performed.</p>

    <h3 id="database-fail-event">Database fail event</h3>

    <p>Storage instance dispatches <code>'fail'</code> <a href="/api/ydn/db/events.html#StorageErrorEvent">StorageErrorEvent</a> when it no longer be used due to fatal error. The event is the last event dispatched. Database request cannot be placed during and after this event. </p>

    <pre><code>db.addEventListener('fail', function (event) {
  var err = event.getError();
  console.log('connection failed with ' + err.name + ' by ' + err.message);
  db = null; // no operation can be placed to the database instance
});
</code></pre>

    <h3 id="database-version-change-event">Database version change event</h3>

    <p>When an app, possibly from other tab, open with new version of the database current event receive <a href="http://www.w3.org/TR/IndexedDB/#idl-def-IDBVersionChangeEvent">IDBVersionChangeEvent</a>. The default operation of the event is closing the connection.    </p>

    <p>An app may want to store data before the connection was closed. This is the last chance to to use the connection. Database request can still be execute at this time, for example to save draft data. If database request have to be make asynchronously, such as sending request to server, default close operation can be prevented by invoking <code>event.preventDefault()</code>. After executing the request, database connection must be closed <code>db.close()</code> so that other pending connection can be established. </p>

    <pre><code>db.addEventListener('versionchange', function(e) {
  db.put('temp', draft_data);
});
</code></pre>

    <h3 id="database-error-event">Database error event</h3>

    <p>Storage instance dispatches <code>'error'</code> <code>StorageErrorEvent</code> received from the storage mechanism. This event is similar to <code>window.onerror</code>, and suppose to be bubble up to global <code>window</code>. In IndexedDB API v2, the event will be bubble up to <code>window</code> object. Application logic should not be placed under this listener. Event handler should be used only for debugging and accounting purpose.</p>

    <pre><code>db.addEventListener('error', function (event) {
  var e = event.getError(); 
  // common errors are AbortError, ConstraintError and UnknownError (possibliy for Quota exceed error).
  // log error for debugging
  console.log('connection failed with ' + e.name);
});
</code></pre>

    <h3 id="installable-events">Installable events</h3>

    <p>When a record is created, modified or deleted from an object store, events can be requested to be emitted from the storage instance. These events, [StoreEvent](/api/ydn/db/events.html#StoreEvent] and [RecordEvent](/api/ydn/db/events.html#RecordEvent], are installed by setting <code>dispatchEvents</code> to <code>true</code> on <a href="/api/ydn/db/schema.html#Store">store schema</a>.</p>

    <pre><code>var schema = {
  stores: [{
    name: 'store1',
    dispatchEvents: true
  }]
}
var db = new ydn.db.Storage('event store', schema);
db.addEventListener(['created', 'updated', 'deleted'], function(event) {
  var keys = [];
  if (event instanceof ydn.db.events.StoreEvent) {
    keys = event.getKeys();
  } else {
    // ydn.db.events.RecordEvent
    keys.push(event.getKey);
  }
  // process keys
});
</code></pre>

    <p>But note that due to requirement for extra query, current implementation cannot distinguish between record created and record updated event.    </p>

    <p>In busy database, these event are noisy and tend to be expensive. Probably in future IndexedDB specification may support build-in event.</p>

  </div>
</div>

<div class="highlight-module  highlight-module--right   highlight-module--remember   highlight-module--inline ">
  <div class="highlight-module__container  icon-exclamation ">
    <div class="highlight-module__content   g-wide--pull-1 highlight-module__inline ">
      <p class="highlight-module__title"> Caution</p>

      
        <p class="highlight-module__text"> Future version of the library may not support installable events. Application can, and should, be designed without using these events. </p>
      

      

    </div>
  </div>
</div>

<div class="container">
  <div class="content">

  </div></div>


      <div class="container clear-both">
        <div class="content">

          <div class="container-medium">
  <nav class="article-nav">
  
    <a class="article-nav-link article-nav-link--prev" title="Previous article" href="/ydn-db/doc/setup/key.html">
      Previous 'Key'
    </a>
  
  
    <a class="article-nav-link article-nav-link--next" title="Next article" href="/ydn-db/doc/setup/polyfill.html" style="float: right;">
      Next 'Polyfill'
    </a>
  
  </nav>
</div>


          <br /><div class="g-comments" data-href=""></div>
        </div>
      </div>



      
        





      
      


<script src="/jsc/ydn.db-dev.js"></script>

    </div> <!-- /.article-container -->
    <div class="container clear">
	<div id="gc-content-license" class="gc-content-license g-wide--3 g-wide--last" >
		
		<div class="container clear">
	<div class="g-wide--3 g-wide--last">
    
		<h4>Authors</h4>
		
		
    <a href="/resources/contributors/index.html#kyawtun">
      Kyaw Tun</a>
		
    
	</div>
</div>

	</div>
</div>

    <footer class="main-footer">
  <div class="main-footer__container container clear">
    <div class="main-footer__list-group">
      <ul class="main-footer__list main-footer__list--primary">
      

        

        
        <li class="sitemap__item sitemap__item--<strong>ydn-db</strong>  sitemap__item--home  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/index.html" title="Go to <strong>YDN-DB</strong>">
            <strong>YDN-DB</strong>
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--download  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/downloads.html" title="Go to Download">
            Download
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--documentation  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/doc/index.html" title="Go to Documentation">
            Documentation
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--api  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/api/ydn/db/storage.html" title="Go to API">
            API
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--examples  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="//dev.yathit.com/ydn-db/doc/example/index.html" title="Go to Examples">
            Examples
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--github  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="https://github.com/yathit/ydn-db" title="Go to GitHub">
            GitHub
          </a>
        </li>
        
      
      </ul>

      <div class="main-footer__google-section">
        <h3 class="main-footer__title"><a href="http://dev.yathit.com/">
          <img id="developers-logo-footer" src="/imgs/yathit-dev-network.svg" alt="Yathit Developer Network logo">
        </a></h3>
        <ul class="main-footer__list main-footer__list--secondary google-list">
          <li><a href="https://www.yathit.com/">Yathit</a></li>
          <li><a href="https://www.yathit.com/terms.html">Terms of Service</a></li>
          <li><a href="https://www.yathit.com/privacy.html">Privacy Policy</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>

    <script src="/jsc/prettify.js"></script>

    
<script src="/js/script.js"></script>
<script src="/jsc/website-app.js"></script>
<script src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>





  </body>
</html>

