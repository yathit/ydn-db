
<!DOCTYPE html>
<html lang="en" class="no-js no-touch" itemscope itemtype="http://schema.org/Article">
  <head>

    
<meta charset="utf-8" />


<title>
  
    Getting started
  
</title>







<meta name="description" content="Getting started with YDN-DB javascript library and fundamental database concepts" />


<link rel="icon" href="/favicon.ico" />

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta id="viewport" name="viewport" content="width=device-width, initial-scale=1" />

<meta name="twitter:card" content="summary">
<meta property="twitter:account_id" content="@yathit" />
<meta property="twitter:site" content="@yathit" />
<meta property="twitter:description" content="Getting started with YDN-DB javascript library and fundamental database concepts" />
<meta property="twitter:creator" content="@yathit" />
<meta property="twitter:image:src" content="/ydn-db/imgs/logo.png" />



<link rel="publisher" href="https://plus.google.com/+KyawTun-Yathit">

<meta itemprop="name" content="
  
    Getting started
  
">
<link itemprop="image" href="/imgs/logo.png">
<meta itemprop="description" content="Getting started with YDN-DB javascript library and fundamental database concepts">

<meta property="og:site_name" content="Yathit" />
<meta property="og:title" content="
  
    Getting started
  
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/ydn-db/" />
<meta property="og:image" content="/ydn-db/imgs/logo.png" />

<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/iccdnijlhdogaccaiafdpjmbakdcdakk">
<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/ldikiokclnbceabnlbkabmcacpiednop">

<link rel="stylesheet" media="screen" href="/css/styles.min.css" />

<script src="/js/analytics.js"></script>

  </head>

  <body class="page-doc article--ydndb-doc theme--ydndb-doc">
    

    <header class="main-header">

	























<nav class="main-nav">

  <header class="main-nav__header">
    <span class="main-nav__current-label">Getting started</span>
  </header>

  <ul class="main-nav__list clear">
  
    
    
    <li class="main-nav__item main-nav__item--<strong>ydn-db</strong>
                main-nav__item--home 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/index.html" title="Go to <strong>YDN-DB</strong>">

        <strong>YDN-DB</strong>

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--download
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/downloads.html" title="Go to Download">

        Download

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--documentation
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/doc/index.html" title="Go to Documentation">

        Documentation

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--api
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/api/ydn/db/storage.html" title="Go to API">

        API

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--examples
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="//dev.yathit.com/ydn-db/doc/example/index.html" title="Go to Examples">

        Examples

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--github
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="https://github.com/yathit/ydn-db" title="Go to GitHub">

        GitHub

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  

  <li class="main-nav__item right">
    <a class="main-nav__link main-nav__link--parent" id="user-login">...</a>
  </li>
  <li class="main-nav__item right">
    <span class="main-nav__link main-nav__link--parent" id="user-name" style="display: none;"></span>
  </li>

  </ul>
  <button class="main-nav__btn btn--toggle-nav">
    <i class="icon icon-menu"></i>
  </button>

</nav>


</header>


    <div class="article-container">
      <div class="editorial-header">
        <div class="container">
          <div class="content">

            <div class="ydn-breadcrumb-before"></div>
            <div id="ydn-breadcrumb" name="ydndb-doc"></div>
            <div class="ydn-breadcrumb-after"></div>

            <h1 class="editorial-header__title"></h1>
            <h2 class="editorial-header__subtitle">Getting started</h2>

            <p class="editorial-header__excerpt">This section illustrate basic usage of the library and explains fundamental database concepts.</p>

          </div>
        </div>
      </div>

      <div class="container-medium">
  <div class="guides" data-current-lesson="0">
    <h3><i class="icon icon-lessons"></i> Guides</h3>
    <ol class="list-guides list-links">
      
        <li title="Setup">
          <a href="/ydn-db/doc/setup/setup.html">Setup</a>
        </li>
      
        <li title="Schema">
          <a href="/ydn-db/doc/setup/schema.html">Schema</a>
        </li>
      
        <li title="Key">
          <a href="/ydn-db/doc/setup/key.html">Key</a>
        </li>
      
        <li title="Events">
          <a href="/ydn-db/doc/setup/events.html">Events</a>
        </li>
      
        <li title="Polyfill">
          <a href="/ydn-db/doc/setup/polyfill.html">Polyfill</a>
        </li>
      
        <li title="Supported browsers and their limitation">
          <a href="/ydn-db/doc/setup/limitation.html">Supported browsers and their limitation</a>
        </li>
      
        <li title="For library developer">
          <a href="/ydn-db/doc/setup/library-developer.html">For library developer</a>
        </li>
      
        <li title="Getting support">
          <a href="/ydn-db/doc/setup/support.html">Getting support</a>
        </li>
      
        <li title="Version 1 release note">
          <a href="/ydn-db/doc/setup/version-1-release-note.html">Version 1 release note</a>
        </li>
      
    </ol>
  </div>
</div>

      <div class="container"><div class="content ">

    <h2 id="how-to-use-the-library">How to use the library</h2>

    <p>YDN-DB is a pure javascript and hence simple include a pre-build file, such as <a href="/jsc/ydn.db-dev.js">ydn.db-dev.js</a> in this page, to your HTML document before using the library. Pre-build files are available in <a href="/ydn-db/downloads.html">download section</a>. Any one of the file will do and only one file is required. Each file are built for specified feature set. For more details about these files, see in <a href="setup.html">setup article</a>.</p>

  </div>
</div>

<div class="highlight-module  highlight-module--right   highlight-module--remember   highlight-module--inline ">
  <div class="highlight-module__container  icon-exclamation ">
    <div class="highlight-module__content   g-wide--pull-1 highlight-module__inline ">
      <p class="highlight-module__title"> Tip</p>

      
        <p class="highlight-module__text"> Pages in this sections include the YDN-DB script and some preloaded data and utility functions, so that you follow the sample code in your browser's developer console to see in action. </p>
      

      

    </div>
  </div>
</div>

<div class="container">
  <div class="content">

    <h2 id="database-connection">Database connection</h2>

    <p>A simple way to initialize a database is by specifying a database
  name.</p>

    <pre><code>db = new ydn.db.Storage('db-name');
db.put('store-name', {message: 'Hello world!'}, 'id1');
db.get('store-name', 'id1').always(function(record) {
  console.log(record);
});
</code></pre>

    <p>The storage instance, <code>ydn.db.Storage</code>, connects to suitable data storage mechanisms ranging from IndexedDB to WebSQL to localStore depending on browser. It will open existing database or create a new database
  with the given database name.</p>

    <p>All database operation methods are asynchronous and result are available as a <a href="https://github.com/promises-aplus/promises-spec"><em>thenble promise</em> object</a>. The resulting promise object accepts two asynchronous functions: <code>done</code> to receive value on successful request and <code>fail</code> to received in case of error. More commonly <code>then</code> method can be used to receive result of both of cases. In case of error, this library always invokes with <code>fail</code> callback with <code>Error</code> object with has <code>name</code> and <code>message</code> for Error name and its description respectively. Generally stack trace, <code>error.stack</code> are available.</p>

    <h2 id="storing-data">Storing data</h2>

    <p>Use <code>put</code> method to insert a new or update existing
  record(s).</p>

    <pre><code>db.put('store1', {test: 'Hello World!'}, 123).then(function(key) {
  console.log(key);
}, function(e) {
  console.error(e.stack);
});
</code></pre>

    <p>The first argument is store name. It is <a href="http://www.w3.org/TR/IndexedDB/#object-store-concept">object store</a> name in IndexedDB and TABLE name in WebSQL. Since a schema is not given, a table or object store will be created if not exist.</p>

    <p>The second argument is record value that we want to store in the database. It should be a simple javascript object ((JSON)[http://json.org/]). A <a href="http://www.w3.org/TR/html5/common-dom-interfaces.html#internal-structured-cloning-algorithm"><em>structured clone</em></a> of the object is stored in the database. A structured clone is similar concept in JSON serialization, but it is more efficient and more powerful. File and Blob are serializable. If the record fail to clone it, underlying database API shall throw uncaught <code>DataCloneError</code>.</p>

    <p>The third argument is <em>primary key</em> of the record. A <a href="http://www.w3.org/TR/IndexedDB/#key-construct">key</a> can be number, string, Date or array of those types. Since we are given primary key separately from the record, it is called <em>out-of-line</em> key.</p>

    <p>Use <code>get</code> method to retrieve it by the primary key.</p>

    <pre><code>req = db.get('store1', 123);
req.done(function(record) {
  console.log(record);
});
req.fail(function(e) {
  console.log(e.message);
});
</code></pre>

    <h2 id="retrieving">Retrieving</h2>

    <p>Keys are the <em>most</em> efficient way to retrieve a record. If we don’t know the key, we <em>must</em> enumerate the
  whole store to find it.</p>

    <p>Let us add some more records to the store.</p>

    <pre><code>var data = [{message: 'a record'}, {message: 'b record'}];
db.putAll('store1', data, ['a', 'b']).always(function(x) {
  console.log(x);
});
</code></pre>

    <p>Notice multiple records are stored by using array of records in single <a href="http://en.wikipedia.org/wiki/Database_transaction"><em>database transaction</em></a>.</p>

    <p>Record values are retrieved by using <code>values</code> <em>database operation method</em>.</p>

    <pre><code>db.values('store1').always(function(records) {
  console.log(records);
});
</code></pre>

    <p>We can also retrieve only primary key of the records using <code>keys</code> database operation method.</p>

    <pre><code>db.keys('store1').done(function(records) {
  console.log(records);
});
</code></pre>

    <p>In contrast to retrieving record values, key only retrieval is much faster because it obviates record value de-serialization. Key is very important for effective querying, and hence keys should be carefully constructed. In addition to primary key, there is <em>secondary key</em>, which is simply called as <em>index key</em>.</p>

    <h2 id="database-schema">Database Schema</h2>

    <p>While running the above codes, we modified database schema on creating new stores. It is not preferable in production usage, because modifying database schema is not a trivial process. It need to notified all connections on other tabs including worker thread as well. Additionally we should use a fixed schema through out a web application for consistency.</p>

  </div>
</div>

<div class="highlight-module  highlight-module--right   highlight-module--remember   highlight-module--inline ">
  <div class="highlight-module__container  icon-exclamation ">
    <div class="highlight-module__content   g-wide--pull-1 highlight-module__inline ">
      <p class="highlight-module__title"> Note</p>

      
        <p class="highlight-module__text"> Always specify database schema on any non-trivial web application. Database schema should not be changed during a life time of an running applicaton. </p>
      

      

    </div>
  </div>
</div>

<div class="container">
  <div class="content">

    <p>The database schema from the database connection is retrieved as follow.</p>

    <pre><code>db.getSchema(function(schema) {
  console.log(schema);
});
</code></pre>

    <p>You will find database version is <code>undefined</code>, since we are not giving a database version. The database is said to be in <em>auto-version</em> mode.</p>

  </div>
</div>

<div class="highlight-module  highlight-module--right   highlight-module--remember   highlight-module--inline ">
  <div class="highlight-module__container  icon-exclamation ">
    <div class="highlight-module__content   g-wide--pull-1 highlight-module__inline ">
      <p class="highlight-module__title"> Note</p>

      
        <p class="highlight-module__text"> Auto-versioning is preferred way of YDN-DB storage instance. </p>
      

      

    </div>
  </div>
</div>

<div class="container">
  <div class="content">

    <p>A <a href="/ydn-db/api/ydn/db/schema.html"><code>database schema</code></a> is define object stores or TABLE(s) in WebSQL. As an example:</p>

    <pre><code>var author_store_schema = {
  name: 'author',
  keyPath: 'email', // optional,
  autoIncrement: false, // optional.
  indexes: [
    {
      name: 'born', // optional
      keyPath: 'born',
      unique: false, // optional, default to false
      multiEntry: false // optional, default to false
    }, {
      name: 'company'
    }, {
      name: 'hobby',
      multiEntry: true
    }
  ] // optional, list of index schema as array.
};
schema = {
  stores: [author_store_schema]
};
</code></pre>

    <p>The above schema define one object store. The <code>name</code> of the object store is ‘author’. Since <code>keyPath</code> is defined, it is using in-line key. Since <code>autoIncrement</code> is <code>false</code>, all records must have a valid key in its ‘email’ field attribute. See more detail about <a href="schema.html">database schema article</a>.</p>

    <p>The object store ‘author’ has three <em>secondary indexes</em>,
  namely ‘born’, ‘company’ and ‘hobby’. In WebSQL, they are column names
  of TABLE ‘author’.
  If <code>keyPath</code> is not defined, it is default to <code>name</code>.
  An example ‘author’ record will be:</p>

    <pre><code>author_1 = {
  email: 'me@aaronsw.com',
  born: 531763200000,
  first: 'Aaron',
  last: 'Swartz',
  company: 'Reddit',
  hobby: ['programming', 'blogging', 'politics']
};
</code></pre>

    <p>If index schema attribute, <code>unique</code> is <code>true</code>, unique constraint is applied on the index key. If unique constraint is void during a database write operation, <a href="http://www.w3.org/TR/IndexedDB/#dfn-constrainterror"><code>ConstriantError</code></a>
  will be issued.</p>

    <p>The index schema attribute, <code>multiEntry</code> is meaningful only for key value of array data type. The index ‘hobby’ has <code>multiEntry</code> of <code>true</code>, so that each element in of the array hobby are indexed individually.</p>

    <p>In addition to ‘stores’ attribute, database schema take ‘version’
  attribute. If version number is specified, the library will open with
  the given version. If the client browser do not have or lower than the
  given version, it will be upgraded as necessary. Client version must
  not be higher than given version. If client version is the same as
  given version, the database schema must be similar. If not similar,
  the library will refuse to connect the database. This library will not
  work, if schema is not known.</p>

    <p>Let us generate some data for querying.</p>

    <pre><code>genAuthors = function(n) {
  var out = [];
  for (var i = 0; i &lt; n; i++) {
    out[i] = {
      first: ydn.testing.randName(),
      last: ydn.testing.randName(),
      born: +(new Date(1900+Math.random()*70, 12*Math.random(), 30*Math.random())),
      email: ydn.testing.randEmail(),
      company: pickOne(companyList),
      hobby: pickMany(hobbyList)
    };
  }
  return out;
};

db = new ydn.db.Storage('test-2', schema);
var authors = genAuthors(10000);
db.putAll('author', authors).then(
  function(ids) {
    console.log(ids.length + ' authors put.');
  }, function(e) {
    console.log(e.message || e);
  }
);
</code></pre>

    <h2 id="basic-query">Basic query</h2>

    <h3 id="counting">Counting</h3>

    <p>Use <code>count</code> method to count number of record in a store or a continuous portion o store.</p>

    <pre><code>db.count('author').done(function(x) {
  console.log('Number of authors: ' + x);
});
</code></pre>

    <p>This is the only aggregate database method provided by the IndexedDB API.</p>

    <h3 id="sorting">Sorting</h3>

    <p>Keys are sorted in the database and hence database query results are <em>always</em> sorted in some way. By default, the following query is sorted by primary key, ‘email’.</p>

    <pre><code>var key_range = null;
db.from('author').list(10).done(function(records) {
  console.log(records);
});
</code></pre>

    <p>If sorting is required, the sorted field have to be indexed. The following illustrate iterating records sorted by ‘born’ date field, one of the three indexed fields.</p>

    <pre><code>db.from('author').order('born').list(10).done(function(records) {
  console.log(records);
});
db.from('author').order('born').reverse().list(10).done(function(records) {
  console.log(records);
});
</code></pre>

    <p>The following example retrieve list of unique hobbies.</p>

    <pre><code>db.from('author').select('hobby').unique(true).list().done(function(hobby) {
  console.log(hobby);
});
</code></pre>

    <h3 id="filtering">Filtering</h3>

    <p>The primary way of filtering is query by <a href="/ydn-db/api/ydn/db/keyrange.html">key range</a>. More sophisticated filtering are iterated merging of key range results. We dedicate these sophisticated filtering on <a href="../query/index.html">query section</a>.</p>

    <p>The following query finds authors born in 1942 February.</p>

    <pre><code>var lower = + new Date(1942, 1, 1); // 1942 February 1
var upper = + new Date(1942, 2, 1); // 1942 March 1
db.from('author').where('born', '&gt;=', lower, '&lt;', upper).list().done(function(records) {
  console.log(records);
  records.map(function(x) {
    console.log(x.first + ' ' + x.last + ' ' + new Date(x.born));
  });
});
</code></pre>

    <h2 id="updating">Updating</h2>

    <p>Use <code>open</code> method to update records.</p>

    <pre><code>var iter = new ydn.db.ValueIterator('author', ydn.db.KeyRange.starts('a'));
var mode = 'readwrite';
var updated = 0;
var deleted = 0;
db.open(function(cursor) {
  var author = cursor.getValue();
  if (author.company == 'Oracle') {
    cursor.clear().done(function(e) {
      deleted++;
    });
  } else if (author.category != 'A') {
    author.category = 'A';
    cursor.update(author).done(function(e) {
      updated++;
    });
  }
}, iter, mode).then(function() {
  console.log(updated + ' records updated, ' + deleted + ' deleted.');
});
</code></pre>

  </div></div>

<script src="/js/ydn-db/data-seeding.js"></script>



      <div class="container clear-both">
        <div class="content">

          <div class="container-medium">
  <nav class="article-nav">
  
  
    <a class="article-nav-link article-nav-link--next" title="Next article" href="/ydn-db/doc/query/index.html" style="float: right;">
      Next 'Query'
    </a>
  
  </nav>
</div>


          <br /><div class="g-comments" data-href="/ydn-db/ydn-db/getting-started.html"></div>
        </div>
      </div>

      


      







    </div> <!-- /.article-container -->

    <div class="container clear">
	<div id="gc-content-license" class="gc-content-license g-wide--3 g-wide--last" >
		
		<div class="container clear">
	<div class="g-wide--3 g-wide--last">
    
	</div>
</div>

	</div>
</div>

    <footer class="main-footer">
  <div class="main-footer__container container clear">
    <div class="main-footer__list-group">
      <ul class="main-footer__list main-footer__list--primary">
      

        

        
        <li class="sitemap__item sitemap__item--<strong>ydn-db</strong>  sitemap__item--home  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/index.html" title="Go to <strong>YDN-DB</strong>">
            <strong>YDN-DB</strong>
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--download  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/downloads.html" title="Go to Download">
            Download
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--documentation  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/doc/index.html" title="Go to Documentation">
            Documentation
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--api  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/api/ydn/db/storage.html" title="Go to API">
            API
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--examples  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="//dev.yathit.com/ydn-db/doc/example/index.html" title="Go to Examples">
            Examples
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--github  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="https://github.com/yathit/ydn-db" title="Go to GitHub">
            GitHub
          </a>
        </li>
        
      
      </ul>

      <div class="main-footer__google-section">
        <h3 class="main-footer__title"><a href="/ydn-db/">
          <img id="developers-logo-footer" src="/imgs/yathit-dev-network.svg" alt="Yathit Developer Network logo">
        </a></h3>
        <ul class="main-footer__list main-footer__list--secondary google-list">
          <li><a href="https://www.yathit.com/">Yathit</a></li>
          <li><a href="https://www.yathit.com/terms.html">Terms of Service</a></li>
          <li><a href="https://www.yathit.com/privacy.html">Privacy Policy</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>

    <script src="/jsc/prettify.js"></script>

    <script src="/jsc/ydn.db-dev.js"></script>
    
<script src="/js/script.js"></script>
<script src="/jsc/website-app.js"></script>
<script src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>





  </body>
</html>

