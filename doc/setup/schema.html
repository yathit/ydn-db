
<!DOCTYPE html>
<html lang="en" class="no-js no-touch">
  <head>

    <link type="text/css" rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro">
    
<meta charset="utf-8" />


<title>
  
    Schema
  
</title>





<meta name="author" content="https://plus.google.com/+KyawTun-Yathit/posts" />



<meta name="description" content="Database Schema" />


<link rel="icon" href="/favicon.ico" />

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta id="viewport" name="viewport" content="width=device-width, initial-scale=1" />

<meta name="twitter:card" content="summary">
<meta property="twitter:account_id" content="@yathit" />
<meta property="twitter:site" content="@yathit" />
<meta property="twitter:description" content="Database Schema" />
<meta property="twitter:creator" content="@yathit" />
<meta property="twitter:image:src" content="http://dev.yathit.com/imgs/logo.png" />


<link rel="author" href="https://plus.google.com/+KyawTun-Yathit/posts">
<link rel="publisher" href="https://plus.google.com/+KyawTun-Yathit">

<meta itemprop="name" content="
  
    Schema
  
">
<link itemprop="image" href="/imgs/logo.png">
<meta itemprop="description" content="Database Schema">

<meta property="og:site_name" content="Yathit" />
<meta property="og:title" content="
  
    Schema
  
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://dev.yathit.com/" />
<meta property="og:image" content="http://dev.yathit.com/imgs/logo.png" />

<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/iccdnijlhdogaccaiafdpjmbakdcdakk">
<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/ldikiokclnbceabnlbkabmcacpiednop">

<link rel="stylesheet" media="screen" href="/css/styles.min.css" />

<script src="/js/analytics.js"></script>

  </head>

  <body class="page-doc page--article article--ydndb-setup theme--ydndb-setup" itemscope itemtype="http://schema.org/TechArticle">
    

    <header class="main-header">

	























<nav class="main-nav">

  <header class="main-nav__header">
    <span class="main-nav__current-label">Schema</span>
  </header>

  <ul class="main-nav__list clear">
  
    
    
    <li class="main-nav__item main-nav__item--<strong>ydn-db</strong>
                main-nav__item--home 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/index.html" title="Go to <strong>YDN-DB</strong>">

        <strong>YDN-DB</strong>

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--download
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/downloads.html" title="Go to Download">

        Download

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--documentation
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/ydn-db/doc/index.html" title="Go to Documentation">

        Documentation

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--api
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="/api/ydn/db/storage.html" title="Go to API">

        API

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--examples
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="//dev.yathit.com/ydn-db/doc/example/index.html" title="Go to Examples">

        Examples

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  
    
    
    <li class="main-nav__item main-nav__item--github
               
               
                 
               
               
               ">
      <a class="main-nav__link main-nav__link--parent" href="https://github.com/yathit/ydn-db" title="Go to GitHub">

        GitHub

        
        <i class="main-nav__icon icon icon-chevron-right"></i>
        
      </a>

      

    </li>
    
  

  <li class="main-nav__item right">
    <a class="main-nav__link main-nav__link--parent" id="user-login">...</a>
  </li>
  <li class="main-nav__item right">
    <span class="main-nav__link main-nav__link--parent" id="user-name" style="display: none;"></span>
  </li>

  </ul>
  <button class="main-nav__btn btn--toggle-nav">
    <i class="icon icon-menu"></i>
  </button>

</nav>


</header>


    <div class="article-container" itemprop="text">

       <div class="ydn-breadcrumb-before"></div>
        <div class="container">
           <div class="content">
             <div id="ydn-breadcrumb" name="ydndb-doc"></div>
           </div>
        </div>
        <div class="ydn-breadcrumb-after"></div>

      <div class="editorial-header">
        <div class="container">
          <div class="content">

            <h1 class="editorial-header__title"></h1>
            <h2 class="editorial-header__subtitle" itemprop="name">Schema</h2>

            <p class="editorial-header__excerpt" itemprop="headline">Database schema define how your data are stored and retrieved.</p>

          </div>
        </div>
      </div>


      <div class="container"><div class="content ">

    <h2 id="indexeddb-database-schema">IndexedDB database schema</h2>

    <p>An <a href="http://www.w3.org/TR/IndexedDB/">IndexedDB</a> database comprises collection of <a href="http://www.w3.org/TR/IndexedDB/#object-store-concept">object stores</a>, which in turn, comprises collection of <a href="http://www.w3.org/TR/IndexedDB/#object-store-concept">indexes</a>. In relational database terms, these two represent TABLE and COLUMN. In YDN-DB, database schema definition of object store along with its indexes, <a href="../full-text/index.html">full-text catalog option</a> and <a href="../sync/index.html">synchronization option</a>. The last two options change schema by adding or modifying object store(s) definition to meet their requirement.</p>

    <p>During <a href="http://www.w3.org/TR/IndexedDB/#widl-IDBFactory-open-IDBOpenDBRequest-DOMString-name-unsigned-long-long-version">opening</a> of <a href="http://www.w3.org/TR/IndexedDB/#dfn-connection">database connection</a>, object stores and indexes must be created in <a href="http://www.w3.org/TR/IndexedDB/#dfn-steps-for-running-a-versionchange-transaction">upgradeneeded phase</a>, if they are not already exist. Existing object store and their indexes can be query synchronously from the database connection. Upgradedneed phase, <code>onupgradeneeded</code> callback on <a href="http://www.w3.org/TR/IndexedDB/#idl-def-IDBOpenDBRequest">IDBOpenDBRequest</a> is invoked only when a connection is opened with higher than existing version.</p>

    <h2 id="ydn-db-database-schema">YDN-DB database schema</h2>

    <p>YDN-DB library create object stores along with their indexes during database connection as defined in the YDN-DB database schema. <a href="/api/ydn/db/schema.html#database">YDN-DB database schema</a> is defined by an JSON object. For example:</p>

    <pre><code>var schema = {
  version: 1,
  autoSchema: false, // must be false when version is defined
  stores: [{
    name: 'author',
    keyPath: 'email', // optional,
    autoIncrement: false, // optional.
    indexes: [
      {
        name: 'born', // optional
        keyPath: 'born',
        unique: false, // optional, default to false
        multiEntry: false // optional, default to false
      }, {
        name: 'company'
      }, {
        name: 'hobby',
        multiEntry: true
      }, {
        name: 'first-name',
        keyPath: 'name.first'
      }, {
        name: 'full-name',
        keyPath: ['name.first', 'name.last']
      }, {
        name: 'name', // index for case in-sensitive sorting
        generator: function(obj) {
          var name = obj.first + ' ' + obj.last;
          return name.toLowerCase();
        }
      }
    ], // optional, list of index schema as array.
    Sync: {
      format: 'gcs',
      Options: {
        bucket: 'ydn-data1',
        prefix: 'author/'
      }
    }
  ],
  fullTextCatalogs: {
    name: 'author-name',
    sources: [{
      storeName: 'author',
      keyPath: 'first',
      weight: 1.0
    }, {
      storeName: 'author',
      keyPath: 'last',
      weight: 0.8
  }]
};
</code></pre>

    <h3 id="database-version">Database version</h3>

    <p><code>version</code> attribute in YDN-DB database schema refer to <a href="http://www.w3.org/TR/IndexedDB/#dfn-version">IndexedDB version</a>. If defined in the schema, it is used on database <code>open</code> method. <code>version</code> value must be positive integer. Generally <code>version</code> value is increased by 1 if an schema change in new version of the application. If <code>version</code> attribute in YDN-DB database schema is not defined, it is said to be <em>auto version</em> mode. In auto version mode, the library increase database version by 1 if existing database schema is different from YDN-DB database schema defined.   </p>

  </div>
</div>

<div class="highlight-module  highlight-module--right   highlight-module--remember   highlight-module--inline ">
  <div class="highlight-module__container  icon-exclamation ">
    <div class="highlight-module__content   g-wide--pull-1 highlight-module__inline ">
      <p class="highlight-module__title"> Tip</p>

      
        <p class="highlight-module__text"> Auto-versioning is preferred way of using YDN-DB storage. </p>
      

      

    </div>
  </div>
</div>

<div class="container">
  <div class="content">

    <p>Database version must not be lower than existing database version. A way to know existing database version is opening the database without giving version. Generally we do not need to know existing database version before opening database, because as application author, we know all versions we used before. Existing database version in the user browser must be one of these versions used before. But in practice, if an application depend on specific database version, managing database version can be quite complicate over years of refactoring the application. Whenever possible, use auto version.</p>

    <p>An application which require to do some logic during database changes can listen <a href="/api/ydn/db/events.html#ready"><code>ready</code> event</a>. The open event listener is invoked with custom event which has <code>getVersion()</code> and <code>getOldVersion()</code> methods to query new and old database versions.    </p>

    <h3 id="ydn-db-store-schema">YDN-DB store schema</h3>

    <p>YDN-DB database schema defines a collection of object stores in <code>stores</code> attribute. Each element of <code>stores</code> define a store representing an <a href="http://www.w3.org/TR/IndexedDB/#object-store">IndexedDB object store</a>. It is similar to TABLE in relational database. The main different is, object stores are unrelated to other object stores where as TABLE can be related to other TABLE by <a href="http://en.wikipedia.org/wiki/Foreign_key">foreign key</a> constraint. Object store is identified by its <a href="http://www.w3.org/TR/IndexedDB/#dfn-object-store-name"><code>name</code></a> attribute.</p>

    <p><em>Object store</em> store records, which comprises a <em>value</em> and a <em>key</em>, primary key. If key is not provided during storing record, a key will be generated by the database, if <code>autoIncrement</code> attribute is set to <code>true</code>. In this case, the object store is said to be using <a href="http://www.w3.org/TR/IndexedDB/#dfn-key-generator">key generator</a>. This is similar to <a href="http://dev.mysql.com/doc/refman/5.0/en/example-auto-increment.html"><code>AUTO_INCREMENT</code></a> in relation database. </p>

    <p>Key can be specified <em>either</em> in the record value or externally, refers to <a href="http://www.w3.org/TR/IndexedDB/#dfn-in-line-keys"><em>in-line</em></a>  or <a href="http://www.w3.org/TR/IndexedDB/#dfn-out-of-line-keys"><em>out-of-line</em></a> key respectively. An object store using <em>in-line</em> key specify <a href="http://www.w3.org/TR/IndexedDB/#dfn-key-path"><code>keyPath</code></a> attribute for extracting key from the record value. Dotted path can be used to extract key nested deeper in the object. For example, the keyPath of <code>name.first</code> will extract ‘Foo’ of the following object.</p>

    <pre><code> {
   name: {
     first: 'Foo',
     last: 'Bar'
   },
   age: 20
 }
</code></pre>

    <p>Out-of-line key are specified during storing record as follow:</p>

    <pre><code>db.put('store1', file, 123);
</code></pre>

    <p>It is preferable to use in-line key over out-of-line key for simplicity.</p>

    <p>The above schema define one object store. The <code>name</code> of the object store is ‘author’. Since <code>keyPath</code> is defined, it is using in-line key. Since <code>autoIncrement</code> is <code>false</code>, all records must have a valid key in its ‘email’ field attribute. </p>

    <p>An object store has a collection of indexes to specify secondary index, as described in next section.</p>

    <p>In additional to these intrinsic properties in object store schema, <code>Sync</code> and <code>fullTextCatalogs</code> can be defined to modified database schema. They are explained in respective <a href="../sync/">synchronization</a> and <a href="../full-text">full-text search</a> sections.</p>

    <h3 id="auto-schema">Auto schema</h3>

    <p>The library also allow to change database schema during life time of an application, by setting <code>autoSchema</code> to <code>true</code>. New object store or index are created as necessary. </p>

    <p>An out-of-line key object store, named as ‘store1’ will be created by:</p>

    <pre><code>db.put('store1', {msg: 'test'}, 123);
</code></pre>

    <p>An in-line key object store, named as ‘store2’ will be created with given key path as follow:</p>

    <pre><code>db.put({name: 'store2', keyPath: 'id'}, {id: 456, msg: 'test'});
</code></pre>

    <p>If require object store is not existed, the database connection is closed and a new database connection is created with updated schema. These database update processes are costly and unreliable.    </p>

  </div>
</div>

<div class="highlight-module  highlight-module--right   highlight-module--remember   highlight-module--inline ">
  <div class="highlight-module__container  icon-exclamation ">
    <div class="highlight-module__content   g-wide--pull-1 highlight-module__inline ">
      <p class="highlight-module__title"> Caution</p>

      
        <p class="highlight-module__text"> Always specify database schema on any non-trivial web application. Database schema should not be changed during a life time of an running application. </p>
      

      

    </div>
  </div>
</div>

<div class="container">
  <div class="content">

    <h3 id="ydn-db-index-schema">YDN-DB index schema</h3>

    <p>If you need to query other than primary key, index must be created by defining in index schema.</p>

    <p>Above object store ‘author’ has six <em>indexes</em>, namely ‘born’, ‘company’, ‘first-name’, ‘full-name’, ‘name’ and ‘hobby’. In WebSQL, they are column names of TABLE ‘author’. If <code>keyPath</code> is not defined, it is default to <code>name</code>.</p>

    <p>An example ‘author’ record will be: </p>

    <pre><code>author_1 = {
  email: 'me@aaronsw.com',
  born: 531763200000,
  name: {
    first: 'Aaron',
    last: 'Swartz',
  }
  company: 'Reddit',
  hobby: ['programming', 'blogging', 'politics']
};
</code></pre>

    <p>If index schema attribute, <code>unique</code> is <code>true</code>, unique constraint is applied on the index key. If unique constraint is void during a database write operation, <a href="http://www.w3.org/TR/IndexedDB/#dfn-constrainterror"><code>ConstraintError</code></a>
  will be issued in reject callback of database request promise.</p>

    <p>When <code>keyPath</code> is defined as an array, they key compose of more than one value forming a <a href="http://en.wikipedia.org/wiki/Compound_key">compound key</a>. Designing compound key plays critical role for <a href="../query/key-join.html">key joining operation</a> and other interesting <a href="../query/compound-key.html">query</a>. For record value <code>author_1</code>, the index value of ‘full-name’ is evaluated as “[‘Aaron’, ‘Swartz’]”.    </p>

    <p>The index schema attribute, <code>multiEntry</code> is meaningful only for key value of array data type. The index ‘hobby’ has <code>multiEntry</code> of <code>true</code>, so that each element in of the array hobby are indexed individually.</p>

    <h3 id="index-key-generator">Index key generator</h3>

    <p>In <a href="https://www.w3.org/2008/webapps/wiki/IndexedDatabaseFeatures">IndexedDB V2</a>, we are likely to have index key generated by a predefined expression. Example use case for key generator expression are many, most stand out use case are key normalization. For example if we want to do case-insensitive search, the key have to normalize into lower or upper case. Sometime a key have to break down into multiple keys.</p>

    <p>Index key generator is defined in index schema with <code>generator</code> attribute for generation function. The function take record value and return index key. <code>multiEntry</code> attribute may set to <code>true</code> to index multiple keys.</p>

    <p>YDN-DB assign generated index key to the keyPath specified in the index using key generator function before storing to the database. If record value already have attribute in the keyPath, it will be overridden. Currently, the generated keys is not deleted on retrieval, although it ought to be.</p>

    <p>In above example, <code>'name'</code> index use key generator. The key generator function combine first and last attribute of the record value and converted to lower case. The index is useful for sorting case-insensitive order by first follow by last attributes. </p>

  </div></div>


      <div class="container clear-both">
        <div class="content">

          <div class="container-medium">
  <nav class="article-nav">
  
    <a class="article-nav-link article-nav-link--prev" title="Previous article" href="/ydn-db/doc/setup/setup.html">
      Previous 'Setup'
    </a>
  
  
    <a class="article-nav-link article-nav-link--next" title="Next article" href="/ydn-db/doc/setup/key.html" style="float: right;">
      Next 'Key'
    </a>
  
  </nav>
</div>


          <br /><div class="g-comments" data-href=""></div>
        </div>
      </div>



      
        





      
      


<script src="/jsc/ydn.db-dev.js"></script>

    </div> <!-- /.article-container -->
    <div class="container clear">
	<div id="gc-content-license" class="gc-content-license g-wide--3 g-wide--last" >
		
		<div class="container clear">
	<div class="g-wide--3 g-wide--last">
    
		<h4>Authors</h4>
		
		
    <a href="/resources/contributors/index.html#kyawtun">
      Kyaw Tun</a>
		
    
	</div>
</div>

	</div>
</div>

    <footer class="main-footer">
  <div class="main-footer__container container clear">
    <div class="main-footer__list-group">
      <ul class="main-footer__list main-footer__list--primary">
      

        

        
        <li class="sitemap__item sitemap__item--<strong>ydn-db</strong>  sitemap__item--home  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/index.html" title="Go to <strong>YDN-DB</strong>">
            <strong>YDN-DB</strong>
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--download  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/downloads.html" title="Go to Download">
            Download
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--documentation  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/ydn-db/doc/index.html" title="Go to Documentation">
            Documentation
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--api  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="/api/ydn/db/storage.html" title="Go to API">
            API
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--examples  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="//dev.yathit.com/ydn-db/doc/example/index.html" title="Go to Examples">
            Examples
          </a>
        </li>
        
      

        

        
        <li class="sitemap__item sitemap__item--github  ">
          <a class="sitemap-list__link sitemap-list__link--parent" href="https://github.com/yathit/ydn-db" title="Go to GitHub">
            GitHub
          </a>
        </li>
        
      
      </ul>

      <div class="main-footer__google-section">
        <h3 class="main-footer__title"><a href="http://dev.yathit.com/">
          <img id="developers-logo-footer" src="/imgs/yathit-dev-network.svg" alt="Yathit Developer Network logo">
        </a></h3>
        <ul class="main-footer__list main-footer__list--secondary google-list">
          <li><a href="https://www.yathit.com/">Yathit</a></li>
          <li><a href="https://www.yathit.com/terms.html">Terms of Service</a></li>
          <li><a href="https://www.yathit.com/privacy.html">Privacy Policy</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>

    <script src="/jsc/prettify.js"></script>

    
<script src="/js/script.js"></script>
<script src="/jsc/website-app.js"></script>
<script src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>





  </body>
</html>

